language: generic

env:
  global:
    #  the following key was generated in 2 steps based on the example here https://github.com/quantopian/zipline/blob/master/.travis.yml
    # ANACONDA_TOKEN
    - secure: "LbdHrvf1y+B/pOSqbM5z3FJa6hHbja1zLP3lp7Wbh/9RMua65FoSj+yXiULi0zLmLT1fTEuDKdWkHXgFiWyIawN5Wb/xBNc7UuJi5L2ko0WPs0UxUn6/vzj+rdmAp7lLSJldELWTyDUpnactkLD/HO43LwKW7IGsXas6U1gzjws9LlX4RoAAGfRyPalSWDEA6+/AYmpofmBNCgktqdmDi+zq5wif9X7JTPtVMllW81NLSQqzJvSYzT6EyONFLTJh8bd9FzOeyrR90MahQo8HjVSXAA0yp1qxJGtJtlRLaMIr+Xz7sec/rfIjvT8Vob8ZeAas38uuU5mAg4UgUTidQRYwZZIv4V0dFIY8eMhSruSTP6vReewT2nGSDwGVhENoW+JFVZj2BQ92t81ml6FGhMN/03nrUd7FqH6/W30AjwqAXtYa6GKM3qcMPu1gPr25Y6D8Z1ybYaCkWaD5gRZTc2G67cb1TBxzh3scgMPuJtxYidPLPAjMXy2uFKOrV6o0ZCCztT3TOWUhQ2XQHRpj5hGsjIMWH6zcPHavAcYJZ2xSROkXrSlNyFluSlKnhl2Ix1EjvUYII60cHwIlqc7HprjNp4CsUBdmBWWy7A176Ph6oMuKvf535J27BNKViVOWYHxIx7O8MBP/MxMDHCSHyqedOcwwj6dEI/mSAC3chnU="

os:
  - linux
  - osx

install:
  - sudo apt-get update
  - sudo apt-get install python3-pyqt4
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh;
    else
      wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    fi
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda
  # Useful for debugging any issues with conda
  - conda info -a
  - conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION pytest pytest-cov
  - source activate test-environment
  - conda install -c ccitools cate-util numpy scipy netcdf4 numexpr pyproj bokeh jupyter ipywidgets hdf4=4.2.12 matplotlib=1.5.1
  - conda install conda-build anaconda-client
  - python setup.py install

script:
  # For the unit-tests, disable Numba JIT, otherwise Coverage wont reach the actual Python code
  - export NUMBA_DISABLE_JIT=1
  - py.test -v --cov=dedop tests
  - conda build -c ccitools recipe

after_success:
  - pip install codecov
  - codecov --env TRAVIS_PYTHON_VERSION
  - RECIPE_OUTPUT=$(conda build -c ccitools recipe --output)
  - INSTALLER_FILE=DeDop*.sh
  - anaconda -v -t $ANACONDA_TOKEN upload "$RECIPE_OUTPUT" -u dedop --force
